{
  "name": "Marketing Calculator - Quote Request",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "calculateur-marketing",
        "options": {}
      },
      "id": "3b540cef-5494-4956-adeb-50daa27725fb",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [
        300,
        500
      ],
      "webhookId": "calculateur-marketing-form"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "timestamp",
              "name": "timestamp",
              "type": "string",
              "value": "={{ $now.format('dd/MM/yyyy HH:mm') }}"
            },
            {
              "id": "lang",
              "name": "lang",
              "type": "string",
              "value": "={{ $json.body.metadata.lang || 'fr' }}"
            },
            {
              "id": "name",
              "name": "name",
              "type": "string",
              "value": "={{ $json.body.contact.name }}"
            },
            {
              "id": "email",
              "name": "email",
              "type": "string",
              "value": "={{ $json.body.contact.email }}"
            },
            {
              "id": "company",
              "name": "company",
              "type": "string",
              "value": "={{ $json.body.contact.company || 'Non renseignÃ©' }}"
            },
            {
              "id": "domains",
              "name": "domains",
              "type": "string",
              "value": "={{ $json.body.selectedDomains.join(', ') }}"
            },
            {
              "id": "duration",
              "name": "duration",
              "type": "number",
              "value": "={{ $json.body.duration }}"
            },
            {
              "id": "monthlyTotal",
              "name": "monthlyTotal",
              "type": "number",
              "value": "={{ $json.body.pricing.monthlyTotal || 0 }}"
            },
            {
              "id": "oneOffTotal",
              "name": "oneOffTotal",
              "type": "number",
              "value": "={{ $json.body.pricing.oneOffTotal || 0 }}"
            },
            {
              "id": "grandTotal",
              "name": "grandTotal",
              "type": "number",
              "value": "={{ $json.body.pricing.grandTotalWithoutBudget || 0 }}"
            },
            {
              "id": "monthlyAfterDiscount",
              "name": "monthlyAfterDiscount",
              "type": "number",
              "value": "={{ Math.round($json.body.pricing.monthlyAfterDiscount || 0) }}"
            },
            {
              "id": "managementFees",
              "name": "managementFees",
              "type": "number",
              "value": "={{ Math.round($json.body.pricing.managementFeesTotal || 0) }}"
            },
            {
              "id": "hasCustomQuote",
              "name": "hasCustomQuote",
              "type": "boolean",
              "value": "={{ $json.body.pricing.hasCustomQuote || false }}"
            },
            {
              "id": "discountPercentage",
              "name": "discountPercentage",
              "type": "number",
              "value": "={{ $json.body.pricing.discountPercentage || 0 }}"
            },
            {
              "id": "totalAdBudget",
              "name": "totalAdBudget",
              "type": "number",
              "value": "={{ $json.body.pricing.adBudgetTotal || 0 }}"
            },
            {
              "id": "trackingTotal",
              "name": "trackingTotal",
              "type": "number",
              "value": "={{ $json.body.pricing.trackingTotal || 0 }}"
            },
            {
              "id": "rawPayload",
              "name": "rawPayload",
              "type": "string",
              "value": "={{ JSON.stringify($json.body) }}"
            }
          ]
        },
        "options": {}
      },
      "id": "b63d9fd5-ee23-4c93-8b3d-fcda631f6029",
      "name": "Prepare Data",
      "type": "n8n-nodes-base.set",
      "position": [
        520,
        500
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "sendTo": "={{ $('Prepare Data').item.json.email }}",
        "subject": "={{ $('Prepare Data').item.json.lang === 'en' ? 'Your Marketing Quote - ' + $('Prepare Data').item.json.monthlyAfterDiscount + 'â‚¬/month | MyDigipal' : 'Votre devis Marketing Digital - ' + $('Prepare Data').item.json.monthlyAfterDiscount + 'â‚¬/mois | MyDigipal' }}",
        "message": "=<div style=\"font-family: 'Segoe UI', Arial, sans-serif; max-width: 650px; margin: 0 auto; background: #ffffff;\">\n\n<!-- Header -->\n<div style=\"background: linear-gradient(135deg, #1e3a5f 0%, #3b82f6 100%); padding: 40px 30px; border-radius: 16px 16px 0 0; text-align: center;\">\n<img src=\"https://mydigipal.com/mydigipal-logo-white.png\" alt=\"MyDigipal\" style=\"height: 40px; margin-bottom: 20px;\" />\n<h1 style=\"color: white; margin: 0; font-size: 28px; font-weight: 600;\">{{ $('Prepare Data').item.json.lang === 'en' ? 'Thank you, ' + $('Prepare Data').item.json.name + '!' : 'Merci ' + $('Prepare Data').item.json.name + ' !' }}</h1>\n<p style=\"color: rgba(255,255,255,0.9); margin: 12px 0 0 0; font-size: 16px;\">{{ $('Prepare Data').item.json.lang === 'en' ? 'Your personalized quote is ready' : 'Ton devis personnalisÃ© est prÃªt' }}</p>\n</div>\n\n<!-- Main Content -->\n<div style=\"padding: 35px 30px; border: 1px solid #E5E7EB; border-top: none;\">\n\n<!-- Thank you message -->\n<div style=\"background: #F0F9FF; padding: 20px; border-radius: 12px; margin-bottom: 30px; border-left: 4px solid #3b82f6;\">\n<p style=\"color: #1e40af; line-height: 1.7; font-size: 15px; margin: 0;\">{{ $('Prepare Data').item.json.lang === 'en' ? 'Thank you for using our marketing calculator! We have received your quote request for <strong>' + $('Prepare Data').item.json.company + '</strong>. Our team will carefully review your needs and contact you within <strong>24 to 48 hours</strong> to discuss your project in detail.' : 'Merci d\\'avoir utilisÃ© notre calculateur marketing ! Nous avons bien reÃ§u ta demande de devis pour <strong>' + $('Prepare Data').item.json.company + '</strong>. Notre Ã©quipe va analyser tes besoins et te recontacter sous <strong>24 Ã  48h</strong> pour en discuter ensemble.' }}</p>\n</div>\n\n<!-- Quote Summary Box -->\n<div style=\"background: #F9FAFB; padding: 25px; border-radius: 16px; margin-bottom: 25px; border: 1px solid #E5E7EB;\">\n<h2 style=\"margin: 0 0 20px 0; color: #1F2937; font-size: 18px; display: flex; align-items: center;\">\n<span style=\"background: #3b82f6; color: white; width: 28px; height: 28px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 14px;\">ðŸ“‹</span>\n{{ $('Prepare Data').item.json.lang === 'en' ? 'Your Quote Summary' : 'RÃ©capitulatif de ton devis' }}\n</h2>\n\n<!-- Services -->\n<div style=\"margin-bottom: 18px; padding-bottom: 18px; border-bottom: 1px solid #E5E7EB;\">\n<p style=\"color: #6B7280; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; margin: 0 0 6px 0; font-weight: 600;\">{{ $('Prepare Data').item.json.lang === 'en' ? 'Selected services' : 'Services sÃ©lectionnÃ©s' }}</p>\n<p style=\"color: #1F2937; margin: 0; font-weight: 500; font-size: 15px;\">{{ $('Prepare Data').item.json.domains }}</p>\n</div>\n\n<!-- Duration -->\n<div style=\"margin-bottom: 18px; padding-bottom: 18px; border-bottom: 1px solid #E5E7EB;\">\n<p style=\"color: #6B7280; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; margin: 0 0 6px 0; font-weight: 600;\">{{ $('Prepare Data').item.json.lang === 'en' ? 'Commitment' : 'Engagement' }}</p>\n<p style=\"color: #1F2937; margin: 0; font-size: 15px;\">{{ $('Prepare Data').item.json.duration }} {{ $('Prepare Data').item.json.lang === 'en' ? 'months' : 'mois' }}{{ $('Prepare Data').item.json.discountPercentage > 0 ? ' <span style=\"background: #DEF7EC; color: #03543F; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;\">-' + $('Prepare Data').item.json.discountPercentage + '%</span>' : '' }}</p>\n</div>\n\n<!-- One-off if any -->\n{{ $('Prepare Data').item.json.oneOffTotal > 0 ? '<div style=\"margin-bottom: 18px; padding-bottom: 18px; border-bottom: 1px solid #E5E7EB;\"><p style=\"color: #6B7280; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; margin: 0 0 6px 0; font-weight: 600;\">' + ($('Prepare Data').item.json.lang === 'en' ? 'One-time services' : 'Services one-off') + '</p><p style=\"color: #1F2937; margin: 0; font-size: 15px;\">' + $('Prepare Data').item.json.oneOffTotal + 'â‚¬</p></div>' : '' }}\n\n<!-- Ad Budget if any -->\n{{ $('Prepare Data').item.json.totalAdBudget > 0 ? '<div style=\"margin-bottom: 18px; padding-bottom: 18px; border-bottom: 1px solid #E5E7EB;\"><p style=\"color: #6B7280; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; margin: 0 0 6px 0; font-weight: 600;\">' + ($('Prepare Data').item.json.lang === 'en' ? 'Advertising budget (not included)' : 'Budget publicitaire (non inclus)') + '</p><p style=\"color: #F59E0B; margin: 0; font-size: 15px; font-weight: 500;\">' + $('Prepare Data').item.json.totalAdBudget + 'â‚¬/' + ($('Prepare Data').item.json.lang === 'en' ? 'month' : 'mois') + '</p></div>' : '' }}\n\n<!-- Price Box -->\n<div style=\"background: linear-gradient(135deg, #1e3a5f 0%, #3b82f6 100%); padding: 25px; border-radius: 12px; text-align: center;\">\n<p style=\"color: rgba(255,255,255,0.85); margin: 0 0 5px 0; font-size: 13px; text-transform: uppercase; letter-spacing: 1px;\">{{ $('Prepare Data').item.json.lang === 'en' ? 'Monthly investment' : 'Investissement mensuel' }}</p>\n<p style=\"color: white; margin: 0; font-size: 42px; font-weight: 700;\">{{ $('Prepare Data').item.json.monthlyAfterDiscount }}â‚¬<span style=\"font-size: 18px; font-weight: 400; opacity: 0.9;\">/{{ $('Prepare Data').item.json.lang === 'en' ? 'mo' : 'mois' }}</span></p>\n<div style=\"border-top: 1px solid rgba(255,255,255,0.2); margin-top: 15px; padding-top: 15px;\">\n<p style=\"color: rgba(255,255,255,0.9); margin: 0; font-size: 14px;\">{{ $('Prepare Data').item.json.lang === 'en' ? 'Total over ' + $('Prepare Data').item.json.duration + ' months: <strong>' + Math.round($('Prepare Data').item.json.grandTotal) + 'â‚¬</strong>' : 'Total sur ' + $('Prepare Data').item.json.duration + ' mois : <strong>' + Math.round($('Prepare Data').item.json.grandTotal) + 'â‚¬</strong>' }}</p>\n</div>\n</div>\n</div>\n\n<!-- What's included -->\n<div style=\"background: #F0FDF4; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #BBF7D0;\">\n<h3 style=\"color: #166534; margin: 0 0 12px 0; font-size: 15px; font-weight: 600;\">{{ $('Prepare Data').item.json.lang === 'en' ? 'âœ¨ Included in all our services' : 'âœ¨ Inclus dans tous nos services' }}</h3>\n<ul style=\"color: #15803D; margin: 0; padding-left: 18px; line-height: 1.9; font-size: 14px;\">\n<li>{{ $('Prepare Data').item.json.lang === 'en' ? 'LLM optimization (ChatGPT, Perplexity, Copilot)' : 'Optimisation pour les LLMs (ChatGPT, Perplexity, Copilot)' }}</li>\n<li>{{ $('Prepare Data').item.json.lang === 'en' ? 'Premium tools (Ahrefs, SEMrush, Meta Business Suite)' : 'Outils premium (Ahrefs, SEMrush, Meta Business Suite)' }}</li>\n<li>{{ $('Prepare Data').item.json.lang === 'en' ? 'Detailed monthly reporting' : 'Reporting mensuel dÃ©taillÃ©' }}</li>\n<li>{{ $('Prepare Data').item.json.lang === 'en' ? 'Responsive support via email and video call' : 'Support rÃ©actif par email et visio' }}</li>\n</ul>\n</div>\n\n<!-- CTA -->\n<div style=\"background: #FEF3C7; padding: 18px 20px; border-radius: 10px; margin-bottom: 25px; border-left: 4px solid #F59E0B;\">\n<p style=\"color: #92400E; margin: 0; font-size: 14px;\">{{ $('Prepare Data').item.json.lang === 'en' ? 'ðŸ’¬ <strong>Questions?</strong> Simply reply to this email - we\\'re here to help!' : 'ðŸ’¬ <strong>Des questions ?</strong> RÃ©ponds simplement Ã  cet email - on est lÃ  pour t\\'aider !' }}</p>\n</div>\n\n<!-- Signature -->\n<div style=\"margin-top: 30px; padding-top: 25px; border-top: 1px solid #E5E7EB;\">\n<p style=\"color: #374151; margin: 0; font-size: 15px;\">{{ $('Prepare Data').item.json.lang === 'en' ? 'Looking forward to speaking with you,' : 'Ã€ trÃ¨s vite,' }}</p>\n<p style=\"margin: 12px 0 0 0;\"><strong style=\"color: #1F2937; font-size: 16px;\">Paul Music</strong></p>\n<p style=\"color: #6B7280; margin: 2px 0; font-size: 14px;\">CEO - MyDigipal</p>\n<p style=\"margin: 10px 0 0 0;\"><a href=\"mailto:paul@mydigipal.com\" style=\"color: #3b82f6; text-decoration: none; font-size: 14px;\">paul@mydigipal.com</a></p>\n</div>\n\n</div>\n\n<!-- Footer -->\n<div style=\"background: #F9FAFB; padding: 20px 30px; border-radius: 0 0 16px 16px; border: 1px solid #E5E7EB; border-top: none; text-align: center;\">\n<p style=\"color: #9CA3AF; margin: 0; font-size: 12px;\">Â© 2025 MyDigipal - Digital Marketing Agency</p>\n<p style=\"margin: 8px 0 0 0;\"><a href=\"https://www.mydigipal.com\" style=\"color: #6B7280; text-decoration: none; font-size: 12px;\">www.mydigipal.com</a></p>\n</div>\n\n</div>",
        "options": {
          "ccList": "paul@mydigipal.com",
          "replyTo": "paul@mydigipal.com"
        }
      },
      "id": "677e4e03-e4b6-428b-8904-a3dfd313111b",
      "name": "Send Email to Prospect",
      "type": "n8n-nodes-base.gmail",
      "position": [
        760,
        400
      ],
      "typeVersion": 2.1,
      "credentials": {
        "gmailOAuth2": {
          "id": "GcKRQn96MQn4VdEL",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "paul@mydigipal.com",
        "subject": "=ðŸ”” Nouveau lead: {{ $('Prepare Data').item.json.name }} ({{ $('Prepare Data').item.json.company }}) - {{ Math.round($('Prepare Data').item.json.grandTotal) }}â‚¬",
        "message": "=<div style=\"font-family: Arial, sans-serif; max-width: 700px;\">\n\n<div style=\"background: linear-gradient(135deg, #1e3a5f 0%, #3b82f6 100%); padding: 20px; border-radius: 8px 8px 0 0;\">\n<h2 style=\"color: white; margin: 0;\">ðŸŽ¯ Nouveau lead depuis le calculateur!</h2>\n<p style=\"color: rgba(255,255,255,0.9); margin: 5px 0 0 0;\">{{ $('Prepare Data').item.json.timestamp }} | Langue: {{ $('Prepare Data').item.json.lang === 'en' ? 'ðŸ‡¬ðŸ‡§ EN' : 'ðŸ‡«ðŸ‡· FR' }}</p>\n</div>\n\n<div style=\"background: #fff; padding: 25px; border: 1px solid #E5E7EB; border-top: none; border-radius: 0 0 8px 8px;\">\n\n<h3 style=\"color: #3b82f6; margin: 0 0 15px 0;\">ðŸ‘¤ Contact</h3>\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 25px;\">\n<tr><td style=\"padding: 10px; border-bottom: 1px solid #eee; width: 140px; font-weight: 600;\">Nom:</td><td style=\"padding: 10px; border-bottom: 1px solid #eee;\">{{ $('Prepare Data').item.json.name }}</td></tr>\n<tr><td style=\"padding: 10px; border-bottom: 1px solid #eee; font-weight: 600;\">Email:</td><td style=\"padding: 10px; border-bottom: 1px solid #eee;\"><a href=\"mailto:{{ $('Prepare Data').item.json.email }}\">{{ $('Prepare Data').item.json.email }}</a></td></tr>\n<tr><td style=\"padding: 10px; border-bottom: 1px solid #eee; font-weight: 600;\">Entreprise:</td><td style=\"padding: 10px; border-bottom: 1px solid #eee;\">{{ $('Prepare Data').item.json.company }}</td></tr>\n</table>\n\n<h3 style=\"color: #3b82f6; margin: 0 0 15px 0;\">ðŸ“Š SÃ©lection</h3>\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 25px;\">\n<tr><td style=\"padding: 10px; border-bottom: 1px solid #eee; font-weight: 600;\">Domaines:</td><td style=\"padding: 10px; border-bottom: 1px solid #eee;\">{{ $('Prepare Data').item.json.domains }}</td></tr>\n<tr><td style=\"padding: 10px; border-bottom: 1px solid #eee; font-weight: 600;\">DurÃ©e:</td><td style=\"padding: 10px; border-bottom: 1px solid #eee;\">{{ $('Prepare Data').item.json.duration }} mois {{ $('Prepare Data').item.json.discountPercentage > 0 ? '(-' + $('Prepare Data').item.json.discountPercentage + '%)' : '' }}</td></tr>\n<tr><td style=\"padding: 10px; border-bottom: 1px solid #eee; font-weight: 600;\">Budget pub:</td><td style=\"padding: 10px; border-bottom: 1px solid #eee;\">{{ $('Prepare Data').item.json.totalAdBudget > 0 ? $('Prepare Data').item.json.totalAdBudget + 'â‚¬/mois' : 'Aucun' }}</td></tr>\n</table>\n\n<div style=\"background: #F0FDF4; padding: 20px; border-radius: 8px; margin-bottom: 25px;\">\n<h3 style=\"color: #166534; margin: 0 0 15px 0;\">ðŸ’° Financier</h3>\n<table style=\"width: 100%; border-collapse: collapse;\">\n<tr><td style=\"padding: 8px 0;\">Mensuel (aprÃ¨s remise):</td><td style=\"text-align: right; font-weight: 600;\">{{ $('Prepare Data').item.json.monthlyAfterDiscount }}â‚¬/mois</td></tr>\n<tr><td style=\"padding: 8px 0;\">Frais de gestion:</td><td style=\"text-align: right;\">{{ $('Prepare Data').item.json.managementFees }}â‚¬/mois</td></tr>\n<tr><td style=\"padding: 8px 0;\">One-off:</td><td style=\"text-align: right;\">{{ $('Prepare Data').item.json.oneOffTotal }}â‚¬</td></tr>\n<tr><td style=\"padding: 8px 0;\">Tracking:</td><td style=\"text-align: right;\">{{ $('Prepare Data').item.json.trackingTotal }}â‚¬</td></tr>\n<tr style=\"font-size: 20px; font-weight: bold; border-top: 2px solid #BBF7D0;\"><td style=\"padding: 15px 0;\">TOTAL ({{ $('Prepare Data').item.json.duration }} mois):</td><td style=\"text-align: right; color: #059669;\">{{ Math.round($('Prepare Data').item.json.grandTotal) }}â‚¬</td></tr>\n</table>\n</div>\n\n<div style=\"text-align: center; padding-top: 20px; border-top: 1px solid #E5E7EB;\">\n<a href=\"mailto:{{ $('Prepare Data').item.json.email }}?subject=Re: Votre devis MyDigipal\" style=\"display: inline-block; background: #3b82f6; color: white; padding: 14px 35px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 15px;\">ðŸ“§ RÃ©pondre au prospect</a>\n</div>\n\n<details style=\"margin-top: 25px;\">\n<summary style=\"cursor: pointer; color: #6B7280; font-size: 13px;\">ðŸ“„ Voir le JSON complet</summary>\n<pre style=\"background: #F3F4F6; padding: 15px; border-radius: 8px; overflow: auto; font-size: 11px; margin-top: 10px;\">{{ $('Prepare Data').item.json.rawPayload }}</pre>\n</details>\n\n</div>\n</div>",
        "options": {}
      },
      "id": "b256f8d1-a2f0-4333-8d0b-ec7d1edb3152",
      "name": "Notify Paul",
      "type": "n8n-nodes-base.gmail",
      "position": [
        760,
        600
      ],
      "typeVersion": 2.1,
      "credentials": {
        "gmailOAuth2": {
          "id": "GcKRQn96MQn4VdEL",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "62a7be75-1e4a-42af-b18e-f105aa434745",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        1000,
        500
      ],
      "typeVersion": 1
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Prepare Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Data": {
      "main": [
        [
          {
            "node": "Send Email to Prospect",
            "type": "main",
            "index": 0
          },
          {
            "node": "Notify Paul",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Email to Prospect": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "27e5ae242e5e368272e0dce999a9b80d042f58fe5b66d36f2c66f7002433a89c"
  }
}
