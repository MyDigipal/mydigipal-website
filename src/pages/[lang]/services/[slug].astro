---
import PageLayout from '@/layouts/PageLayout.astro';
import { type Language, languages } from '@/i18n/config';
import { t } from '@/i18n/utils';
import { getCollection } from 'astro:content';

// SEO Schemas
import ServiceSchema from '@/components/seo/ServiceSchema.astro';
import BreadcrumbSchema from '@/components/seo/BreadcrumbSchema.astro';

// Components
import Badge from '@/components/ui/Badge.astro';
import Button from '@/components/ui/Button.astro';
import Icon from '@/components/ui/Icon.astro';

// Sections
import HeroService from '@/components/sections/HeroService.astro';
import MetricsCounter from '@/components/sections/MetricsCounter.astro';
import WhyChooseUs from '@/components/sections/WhyChooseUs.astro';
import AuditStrategySection from '@/components/sections/AuditStrategySection.astro';
import TechnicalSEOSection from '@/components/sections/TechnicalSEOSection.astro';
import AIContentShowcase from '@/components/sections/AIContentShowcase.astro';
import TestimonialSpotlight from '@/components/sections/TestimonialSpotlight.astro';
import FinalCTA from '@/components/sections/FinalCTA.astro';
import FAQSection from '@/components/sections/FAQSection.astro';

// Google Ads specific sections
import GoogleAdsChannels from '@/components/sections/GoogleAdsChannels.astro';
import WhyGoogleAds from '@/components/sections/WhyGoogleAds.astro';
import GoogleAdsProcess from '@/components/sections/GoogleAdsProcess.astro';

// Paid Social specific sections
import WhyPaidSocial from '@/components/sections/WhyPaidSocial.astro';
import PaidSocialChannels from '@/components/sections/PaidSocialChannels.astro';
import PaidSocialProcess from '@/components/sections/PaidSocialProcess.astro';
import PaidSocialServices from '@/components/sections/PaidSocialServices.astro';

// AI Training specific sections
import WhyAITraining from '@/components/sections/WhyAITraining.astro';
import AITrainingModules from '@/components/sections/AITrainingModules.astro';
import TrainingClients from '@/components/sections/TrainingClients.astro';
import TrainingTestimonials from '@/components/sections/TrainingTestimonials.astro';
import TrainingProcess from '@/components/sections/TrainingProcess.astro';
import TrainingBenefitsManagers from '@/components/sections/TrainingBenefitsManagers.astro';
import TrainingBenefitsEmployees from '@/components/sections/TrainingBenefitsEmployees.astro';
import TrainingAgenda from '@/components/sections/TrainingAgenda.astro';
import TrainingUseCases from '@/components/sections/TrainingUseCases.astro';

// Emailing specific sections
import WhyEmailing from '@/components/sections/WhyEmailing.astro';
import EmailingServices from '@/components/sections/EmailingServices.astro';
import EmailingAIPersonalization from '@/components/sections/EmailingAIPersonalization.astro';

// Tracking & Reporting specific sections
import WhyTracking from '@/components/sections/WhyTracking.astro';
import TrackingServices from '@/components/sections/TrackingServices.astro';
import TrackingTools from '@/components/sections/TrackingTools.astro';
import CookieCompliance from '@/components/sections/CookieCompliance.astro';
import ReportingTiers from '@/components/sections/ReportingTiers.astro';
import AIReportPreview from '@/components/sections/AIReportPreview.astro';

// AI Solutions specific sections
import WhyAISolutions from '@/components/sections/WhyAISolutions.astro';
import AIUseCases from '@/components/sections/AIUseCases.astro';
import AIProcess from '@/components/sections/AIProcess.astro';

// AI Content specific sections
import WhyAIContent from '@/components/sections/WhyAIContent.astro';
import AIContentProcess from '@/components/sections/AIContentProcess.astro';
import ContentTypes from '@/components/sections/ContentTypes.astro';
import AIContentDelivery from '@/components/sections/AIContentDelivery.astro';

// B2B ABM specific sections
import WhyABM from '@/components/sections/b2b/WhyABM.astro';
import ABMApproach from '@/components/sections/b2b/ABMApproach.astro';
import ABMServices from '@/components/sections/b2b/ABMServices.astro';
import ABMWorkModes from '@/components/sections/b2b/ABMWorkModes.astro';
import B2BFunnel from '@/components/sections/b2b/B2BFunnel.astro';
import ABMTrainingPackages from '@/components/sections/b2b/ABMTrainingPackages.astro';
import ABMCalculatorCTA from '@/components/sections/b2b/ABMCalculatorCTA.astro';
import ABMTestimonials from '@/components/sections/b2b/ABMTestimonials.astro';
import ABMFAQ from '@/components/sections/b2b/ABMFAQ.astro';

// Generic FAQ component
import ServiceFAQ from '@/components/sections/ServiceFAQ.astro';

// Case Study Carousel
import CaseStudyCarousel from '@/components/sections/CaseStudyCarousel.astro';

// Social proof
import TrustedBy from '@/components/sections/TrustedBy.astro';

export async function getStaticPaths() {
  const paths = [];

  for (const lang of Object.keys(languages)) {
    try {
      const services = await getCollection('services', ({ id }) => {
        return id.startsWith(`${lang}/`);
      });

      for (const service of services) {
        const slug = service.id.replace(`${lang}/`, '').replace('.mdx', '');
        paths.push({
          params: { lang, slug },
          props: { service },
        });
      }
    } catch (e) {
      // Collection might be empty
    }
  }

  return paths;
}

const { lang, slug } = Astro.params as { lang: Language; slug: string };
const { service } = Astro.props;

const {
  title,
  description,
  color = 'primary',
  hero,
  metrics,
  testimonial,
  calculatorServiceId,
  seo
} = service.data;

// Check if this is the SEO service page
const isSEOService = slug === 'seo';
// Check if this is the Google Ads service page
const isGoogleAdsService = slug === 'google-ads';
// Check if this is the Paid Social service page
const isPaidSocialService = slug === 'paid-social';
// Check if this is the AI Training service page
const isAITrainingService = slug === 'ai-training';
// Check if this is the Emailing service page
const isEmailingService = slug === 'emailing';
// Check if this is the AI Solutions service page
const isAISolutionsService = slug === 'ai-solutions';
// Check if this is the B2B ABM service page
const isB2BABMService = slug === 'b2b-abm';
// Check if this is the Tracking & Reporting service page
const isTrackingService = slug === 'tracking-reporting';
// Check if this is the AI Content service page
const isAIContentService = slug === 'ai-content';

// Check if this is any AI service page (for blog section)
const isAIService = isAITrainingService || isAISolutionsService || isAIContentService;

// Blog articles data for AI service pages
const blogArticles = {
  en: [
    {
      title: "How to Train Your Team on AI",
      description: "Scalable methods and use cases for building AI capability.",
      image: "/images/Blog Thumbnails/EN - how-to-train-teams-on-ai.png",
      href: "/en/blog/how-to-train-teams-on-ai"
    },
    {
      title: "Building AI Agents with n8n",
      description: "The complete 2026 guide to autonomous AI workflow automation.",
      image: "/images/Blog Thumbnails/EN - agents-ia-n8n-automatisation.png",
      href: "/en/blog/ai-agents-n8n-automation"
    },
    {
      title: "Claude Code: Developer Productivity",
      description: "Master Anthropic's agentic CLI tool for 3-10x faster coding.",
      image: "/images/Blog Thumbnails/EN - claude-code-developer-productivity.png",
      href: "/en/blog/claude-code-developer-productivity"
    }
  ],
  fr: [
    {
      title: "Former votre équipe à l'IA",
      description: "Méthodes scalables et cas d'usage pour développer les compétences IA.",
      image: "/images/Blog Thumbnails/EN - how-to-train-teams-on-ai.png",
      href: "/fr/blog/how-to-train-teams-on-ai"
    },
    {
      title: "Créer des Agents IA avec n8n",
      description: "Le guide complet 2026 pour l'automatisation de workflows autonomes.",
      image: "/images/Blog Thumbnails/EN - agents-ia-n8n-automatisation.png",
      href: "/fr/blog/ai-agents-n8n-automation"
    },
    {
      title: "Claude Code : Productivité Développeur",
      description: "Maîtrisez l'outil CLI d'Anthropic pour coder 3-10x plus vite.",
      image: "/images/Blog Thumbnails/EN - claude-code-developer-productivity.png",
      href: "/fr/blog/claude-code-developer-productivity"
    }
  ]
};

const blogSectionContent = {
  en: {
    badge: "Learn More",
    title: "Our AI Resources",
    subtitle: "Deep-dive articles to master AI in your organization",
    readMore: "Read article",
    viewAll: "View all AI articles"
  },
  fr: {
    badge: "En Savoir Plus",
    title: "Nos Ressources IA",
    subtitle: "Des articles approfondis pour maîtriser l'IA dans votre organisation",
    readMore: "Lire l'article",
    viewAll: "Voir tous les articles IA"
  }
};

const articles = blogArticles[lang] || blogArticles.en;
const blogContent = blogSectionContent[lang] || blogSectionContent.en;

// SEO Schema data
const serviceUrl = `https://mydigipal.com/${lang}/services/${slug}`;
const breadcrumbItems = [
  { name: lang === 'fr' ? 'Accueil' : 'Home', url: `/${lang}` },
  { name: 'Services', url: `/${lang}/services` },
  { name: title, url: `/${lang}/services/${slug}` }
];
---

<PageLayout
  lang={lang}
  title={seo?.title || title}
  description={seo?.description || description}
>
  <!-- Structured Data -->
  <ServiceSchema
    name={title}
    description={description}
    url={serviceUrl}
    lang={lang}
  />
  <BreadcrumbSchema items={breadcrumbItems} />

  <!-- Hero Section - Immersive with Parallax -->
  <HeroService
    lang={lang}
    badge={hero?.badge}
    headline={hero?.headline || title}
    subheadline={hero?.subheadline}
    description={description}
    color={color}
  />

  <!-- Metrics Counter -->
  {metrics && metrics.length > 0 && (
    <MetricsCounter metrics={metrics} color={color} />
  )}

  <!-- Why Choose Us - 4 Blocks -->
  {isSEOService && (
    <WhyChooseUs lang={lang} color={color} />
  )}

  <!-- SEO Service: 3 Interactive Sections -->
  {isSEOService && (
    <>
      <!-- Phase 1: Audit & Strategy (Accordion) -->
      <AuditStrategySection lang={lang} color={color} />

      <!-- Phase 2: Technical SEO (Flip Cards) -->
      <TechnicalSEOSection lang={lang} color={color} />

      <!-- Phase 3: AI Content Production (Immersive Showcase with CTA) -->
      <AIContentShowcase lang={lang} color={color} />
    </>
  )}

  <!-- Google Ads Service: Interactive Sections -->
  {isGoogleAdsService && (
    <>
      <!-- Why Google Ads - Educational Section -->
      <WhyGoogleAds lang={lang} color={color} />

      <!-- Google Ads Channels - Visual Showcase -->
      <GoogleAdsChannels lang={lang} color={color} />

      <!-- Process Timeline -->
      <GoogleAdsProcess lang={lang} color={color} />
    </>
  )}

  <!-- Paid Social Service: Interactive Sections -->
  {isPaidSocialService && (
    <>
      <!-- Why Paid Social - Educational Section -->
      <WhyPaidSocial lang={lang} color={color} />

      <!-- Paid Social Channels - Visual Showcase -->
      <PaidSocialChannels lang={lang} color={color} />

      <!-- Full-Service Offerings -->
      <PaidSocialServices lang={lang} color={color} />

      <!-- Process Timeline -->
      <PaidSocialProcess lang={lang} color={color} />

      <!-- Case Studies Carousel -->
      <CaseStudyCarousel lang={lang} caseStudyIds={['symbl-ai', 'gwi', 'genesys']} color={color} />
    </>
  )}

  <!-- AI Training Service: Interactive Sections -->
  {isAITrainingService && (
    <>
      <!-- Why AI Training - Educational Section -->
      <WhyAITraining lang={lang} />

      <!-- Department Use Cases -->
      <TrainingUseCases lang={lang} />

      <!-- Training Testimonials with Photos (moved up) -->
      <TrainingTestimonials lang={lang} />

      <!-- Benefits for Managers/Directors -->
      <TrainingBenefitsManagers lang={lang} />

      <!-- Benefits for Employees -->
      <TrainingBenefitsEmployees lang={lang} />

      <!-- Training Client Logos -->
      <TrainingClients lang={lang} />

      <!-- Full Day Agenda with CRAFT Method -->
      <TrainingAgenda lang={lang} />

      <!-- Training Process - How We Create Your Training -->
      <TrainingProcess lang={lang} />

      <!-- Training Packages -->
      <AITrainingModules lang={lang} />
    </>
  )}

  <!-- Emailing Service: Interactive Sections -->
  {isEmailingService && (
    <>
      <!-- Why Email Marketing - Stats & Renaissance -->
      <WhyEmailing lang={lang} />

      <!-- Full-Service Offerings -->
      <EmailingServices lang={lang} />

      <!-- AI Personalization Process -->
      <EmailingAIPersonalization lang={lang} />
    </>
  )}

  <!-- AI Solutions Service: Interactive Sections -->
  {isAISolutionsService && (
    <>
      <!-- Why AI Development - Educational Section -->
      <WhyAISolutions lang={lang} />

      <!-- Use Cases -->
      <AIUseCases lang={lang} />

      <!-- Process & Approach -->
      <AIProcess lang={lang} />
    </>
  )}

  <!-- B2B ABM Service: Comprehensive Sections -->
  {isB2BABMService && (
    <>
      <!-- What is ABM - Educational Section -->
      <WhyABM lang={lang} />

      <!-- Crawl, Walk, Run Methodology -->
      <ABMApproach lang={lang} />

      <!-- À La Carte Services Grid -->
      <ABMServices lang={lang} />

      <!-- Consulting vs Execution Work Modes -->
      <ABMWorkModes lang={lang} />

      <!-- B2B Funnel Stages -->
      <B2BFunnel lang={lang} />

      <!-- Calculator CTA -->
      <ABMCalculatorCTA lang={lang} />

      <!-- ABM Training Packages -->
      <ABMTrainingPackages lang={lang} />

      <!-- B2B Testimonials -->
      <ABMTestimonials lang={lang} />

      <!-- ABM FAQ -->
      <ABMFAQ lang={lang} />
    </>
  )}

  <!-- Tracking & Reporting Service: Comprehensive Sections -->
  {isTrackingService && (
    <>
      <!-- Why Tracking - Educational Section -->
      <WhyTracking lang={lang} />

      <!-- Tracking Services Grid -->
      <TrackingServices lang={lang} />

      <!-- Tools & Integrations (CMS, Analytics, CRM) -->
      <TrackingTools lang={lang} />

      <!-- Cookie & Privacy Compliance -->
      <CookieCompliance lang={lang} />

      <!-- Reporting Tiers (Looker Studio, Tableau, AI) -->
      <ReportingTiers lang={lang} />

      <!-- AI Report Preview with Chat -->
      <AIReportPreview lang={lang} />
    </>
  )}

  <!-- AI Content Service: Comprehensive Sections -->
  {isAIContentService && (
    <>
      <!-- Why AI Content - Educational Section -->
      <WhyAIContent lang={lang} />

      <!-- 4-Step Process with Visual Popups -->
      <AIContentProcess lang={lang} />

      <!-- Content Types Grid -->
      <ContentTypes lang={lang} />

      <!-- Deliverables & Delivery Options -->
      <AIContentDelivery lang={lang} />
    </>
  )}

  <!-- Google Ads Case Studies -->
  {isGoogleAdsService && (
    <CaseStudyCarousel lang={lang} caseStudyIds={['dmd-group', 'quantum-metrics', 'genesys']} color={color} />
  )}

  <!-- Testimonial Spotlight (skip for AI Training and B2B ABM which have their own testimonials) -->
  {testimonial && !isAITrainingService && !isB2BABMService && (
    <TestimonialSpotlight
      quote={testimonial.quote}
      author={testimonial.author}
      role={testimonial.role}
      company={testimonial.company}
      image={testimonial.image}
      companyLogo={testimonial.companyLogo}
    />
  )}

  <!-- Trusted By - Client Logos (skip for AI Training and B2B ABM which have their own) -->
  {!isAITrainingService && !isB2BABMService && (
    <TrustedBy lang={lang} variant="compact" />
  )}

  <!-- AI Blog Articles Section (for AI service pages only) -->
  {isAIService && (
    <section class="py-24 bg-white">
      <div class="container-custom">
        <div class="text-center mb-16 animate-on-scroll">
          <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-violet-100 text-violet-700 font-medium mb-6">
            <Icon name="book" size={16} />
            <span>{blogContent.badge}</span>
          </div>
          <h2 class="text-4xl md:text-5xl font-bold text-slate-900 mb-4">
            {blogContent.title}
          </h2>
          <p class="text-lg text-slate-500">
            {blogContent.subtitle}
          </p>
        </div>

        <div class="grid md:grid-cols-3 gap-8">
          {articles.map((article, index) => (
            <a
              href={article.href}
              class="group block bg-white rounded-2xl border border-slate-200 overflow-hidden hover:border-violet-300 hover:shadow-xl transition-all duration-300 animate-on-scroll"
              style={`animation-delay: ${index * 100}ms`}
            >
              <div class="aspect-video overflow-hidden">
                <img
                  src={article.image}
                  alt={article.title}
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                />
              </div>
              <div class="p-6">
                <h3 class="text-lg font-bold text-slate-900 mb-2 group-hover:text-violet-600 transition-colors">
                  {article.title}
                </h3>
                <p class="text-slate-600 text-sm mb-4">
                  {article.description}
                </p>
                <div class="flex items-center gap-2 text-violet-600 font-medium text-sm group-hover:gap-3 transition-all">
                  <span>{blogContent.readMore}</span>
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                  </svg>
                </div>
              </div>
            </a>
          ))}
        </div>

        <div class="text-center mt-12">
          <Button href={`/${lang}/blog?category=ai`} variant="outline" size="lg">
            {blogContent.viewAll}
          </Button>
        </div>
      </div>
    </section>
  )}

  <!-- Final CTA (skip for B2B ABM which has its own) -->
  {!isB2BABMService && (
    <FinalCTA lang={lang} color={color} />
  )}

  <!-- FAQ Section -->
  {isSEOService && (
    <ServiceFAQ lang={lang} service="seo" color={color} />
  )}
  {isGoogleAdsService && (
    <ServiceFAQ lang={lang} service="google-ads" color={color} />
  )}
  {isPaidSocialService && (
    <ServiceFAQ lang={lang} service="paid-social" color={color} />
  )}
  {isAITrainingService && (
    <ServiceFAQ lang={lang} service="ai-training" color="training" />
  )}
  {isEmailingService && (
    <ServiceFAQ lang={lang} service="emailing" color="emailing" />
  )}
  {isAISolutionsService && (
    <ServiceFAQ lang={lang} service="ai-solutions" color="ai" />
  )}
  {isTrackingService && (
    <ServiceFAQ lang={lang} service="tracking-reporting" color="tracking" />
  )}
  {isAIContentService && (
    <ServiceFAQ lang={lang} service="ai-content" color="content" />
  )}
</PageLayout>

<style>
  /* Page-specific animations */
  @keyframes float {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(5deg); }
  }

  @keyframes pulse-glow {
    0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
    50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.6); }
  }
</style>
