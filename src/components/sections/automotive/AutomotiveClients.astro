---
import type { Language } from '@/i18n/config';

interface Client {
  name: string;
  logo: string;
}

interface Props {
  lang: Language;
  clients: Client[];
}

const { lang, clients } = Astro.props;

const content = {
  en: {
    title: 'Trusted by Leading Dealerships',
  },
  fr: {
    title: 'Ils Nous Font Confiance',
  },
};

const t = content[lang];

// Duplicate for seamless loop
const duplicatedClients = [...clients, ...clients];
---

<section class="py-12 bg-slate-50 overflow-hidden">
  <div class="container-custom mb-8">
    <h3 class="heading-4 text-center text-slate-500">{t.title}</h3>
  </div>

  <!-- Infinite Scrolling Carousel -->
  <div class="logo-carousel relative">
    <!-- Gradient masks -->
    <div class="absolute left-0 top-0 bottom-0 w-24 bg-gradient-to-r from-slate-50 to-transparent z-10 pointer-events-none"></div>
    <div class="absolute right-0 top-0 bottom-0 w-24 bg-gradient-to-l from-slate-50 to-transparent z-10 pointer-events-none"></div>

    <!-- Scrolling Row -->
    <div class="logo-track scroll-left flex gap-8 py-4">
      {duplicatedClients.map((client) => (
        <div class="logo-item group flex-shrink-0">
          <div class="w-36 h-20 bg-white rounded-xl shadow-soft border border-slate-100 flex items-center justify-center p-4 transition-all duration-300 group-hover:shadow-lg group-hover:scale-110 group-hover:border-sky-300">
            <img
              src={client.logo}
              alt={client.name}
              class="max-w-full max-h-full object-contain filter grayscale opacity-60 group-hover:grayscale-0 group-hover:opacity-100 transition-all duration-300"
              loading="lazy"
            />
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  /* Infinite scroll animation */
  .logo-track {
    animation-timing-function: linear;
    animation-iteration-count: infinite;
  }

  .scroll-left {
    animation: scroll-left 30s linear infinite;
  }

  @keyframes scroll-left {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  /* Pause on hover */
  .logo-carousel:hover .logo-track {
    animation-play-state: paused;
  }

  /* Logo item hover effect */
  .logo-item {
    perspective: 1000px;
  }

  .logo-item:hover {
    z-index: 10;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .scroll-left {
      animation-duration: 20s;
    }
    .logo-item > div {
      width: 100px;
      height: 60px;
    }
  }
</style>

<script>
  // Pause animation when not in viewport for performance
  const carousel = document.querySelector('.logo-carousel');
  if (carousel) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          const tracks = entry.target.querySelectorAll('.logo-track');
          tracks.forEach((track) => {
            if (entry.isIntersecting) {
              (track as HTMLElement).style.animationPlayState = 'running';
            } else {
              (track as HTMLElement).style.animationPlayState = 'paused';
            }
          });
        });
      },
      { threshold: 0.1 }
    );
    observer.observe(carousel);
  }
</script>
