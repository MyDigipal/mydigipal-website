---
import type { Language } from '@/i18n/config';
import Icon from '@/components/ui/Icon.astro';

interface Props {
  lang: Language;
  color?: 'automotive' | 'ads' | 'social' | 'primary';
}

const { lang, color = 'automotive' } = Astro.props;

const translations = {
  en: {
    title: 'How Dynamic Ads Work',
    subtitle: 'Your vehicles automatically reach the right buyers across all platforms',
    steps: [
      {
        icon: 'database',
        title: 'Vehicle Catalog',
        description: 'Your inventory syncs automatically with all advertising platforms'
      },
      {
        icon: 'refresh-cw',
        title: 'Real-Time Updates',
        description: 'Prices, availability, and details update daily or hourly'
      },
      {
        icon: 'target',
        title: 'Smart Targeting',
        description: 'AI matches vehicles to buyers based on their interests'
      },
      {
        icon: 'globe',
        title: 'Multi-Platform Delivery',
        description: 'Ads appear on Facebook, Instagram & Google simultaneously'
      }
    ],
    catalogLabel: 'Your Vehicle Catalog',
    feedLabel: 'Automated Feed',
    platforms: 'Ad Platforms',
    buyers: 'Right Buyers'
  },
  fr: {
    title: 'Comment Fonctionnent les Dynamic Ads',
    subtitle: 'Vos véhicules atteignent automatiquement les bons acheteurs sur toutes les plateformes',
    steps: [
      {
        icon: 'database',
        title: 'Catalogue Véhicules',
        description: 'Votre inventaire se synchronise automatiquement avec toutes les plateformes'
      },
      {
        icon: 'refresh-cw',
        title: 'Mises à Jour Temps Réel',
        description: 'Prix, disponibilité et détails mis à jour quotidiennement ou toutes les heures'
      },
      {
        icon: 'target',
        title: 'Ciblage Intelligent',
        description: 'L\'IA associe les véhicules aux acheteurs selon leurs intérêts'
      },
      {
        icon: 'globe',
        title: 'Diffusion Multi-Plateforme',
        description: 'Les annonces apparaissent sur Facebook, Instagram & Google simultanément'
      }
    ],
    catalogLabel: 'Votre Catalogue Véhicules',
    feedLabel: 'Flux Automatisé',
    platforms: 'Plateformes Pub',
    buyers: 'Bons Acheteurs'
  }
};

const t = translations[lang] || translations.en;
---

<section class="section bg-white overflow-hidden">
  <div class="container-custom">
    <!-- Header -->
    <div class="text-center max-w-3xl mx-auto mb-16 animate-on-scroll">
      <h2 class="heading-2 mb-4">{t.title}</h2>
      <p class="body-large text-slate-600">{t.subtitle}</p>
    </div>

    <!-- Animated Flow Diagram -->
    <div class="relative max-w-5xl mx-auto mb-16">
      <!-- Desktop Flow -->
      <div class="hidden lg:block">
        <div class="flex items-center justify-between gap-4">
          <!-- Catalog Node -->
          <div class="flow-node animate-on-scroll" style="animation-delay: 0ms">
            <div class="w-32 h-32 rounded-2xl bg-gradient-to-br from-sky-500 to-blue-600 flex flex-col items-center justify-center text-white shadow-lg shadow-sky-500/30 group hover:scale-105 transition-transform">
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center mb-2">
                <Icon name="car" size={24} />
              </div>
              <span class="text-xs font-medium text-center px-2">{t.catalogLabel}</span>
            </div>
          </div>

          <!-- Arrow 1 -->
          <div class="flow-arrow flex-1 flex items-center animate-on-scroll" style="animation-delay: 100ms">
            <div class="h-1 flex-1 bg-gradient-to-r from-sky-500 to-indigo-500 rounded-full relative overflow-hidden">
              <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/50 to-transparent animate-flow"></div>
            </div>
            <Icon name="arrow-right" size={24} class="text-indigo-500 -ml-1" />
          </div>

          <!-- Feed Node -->
          <div class="flow-node animate-on-scroll" style="animation-delay: 200ms">
            <div class="w-32 h-32 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex flex-col items-center justify-center text-white shadow-lg shadow-indigo-500/30 group hover:scale-105 transition-transform">
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center mb-2 animate-spin-slow">
                <Icon name="refresh-cw" size={24} />
              </div>
              <span class="text-xs font-medium text-center px-2">{t.feedLabel}</span>
            </div>
          </div>

          <!-- Arrow 2 -->
          <div class="flow-arrow flex-1 flex items-center animate-on-scroll" style="animation-delay: 300ms">
            <div class="h-1 flex-1 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full relative overflow-hidden">
              <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/50 to-transparent animate-flow"></div>
            </div>
            <Icon name="arrow-right" size={24} class="text-pink-500 -ml-1" />
          </div>

          <!-- Platforms Node -->
          <div class="flow-node animate-on-scroll" style="animation-delay: 400ms">
            <div class="w-40 h-32 rounded-2xl bg-gradient-to-br from-pink-500 to-rose-600 flex flex-col items-center justify-center text-white shadow-lg shadow-pink-500/30 group hover:scale-105 transition-transform">
              <div class="flex gap-2 mb-2">
                <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center platform-icon" style="animation-delay: 0ms">
                  <Icon name="facebook" size={20} />
                </div>
                <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center platform-icon" style="animation-delay: 100ms">
                  <Icon name="instagram" size={20} />
                </div>
                <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center platform-icon" style="animation-delay: 200ms">
                  <Icon name="globe" size={20} />
                </div>
              </div>
              <span class="text-xs font-medium text-center px-2">{t.platforms}</span>
            </div>
          </div>

          <!-- Arrow 3 -->
          <div class="flow-arrow flex-1 flex items-center animate-on-scroll" style="animation-delay: 500ms">
            <div class="h-1 flex-1 bg-gradient-to-r from-rose-500 to-amber-500 rounded-full relative overflow-hidden">
              <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/50 to-transparent animate-flow"></div>
            </div>
            <Icon name="arrow-right" size={24} class="text-amber-500 -ml-1" />
          </div>

          <!-- Buyers Node -->
          <div class="flow-node animate-on-scroll" style="animation-delay: 600ms">
            <div class="w-32 h-32 rounded-2xl bg-gradient-to-br from-amber-500 to-orange-600 flex flex-col items-center justify-center text-white shadow-lg shadow-amber-500/30 group hover:scale-105 transition-transform">
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center mb-2">
                <Icon name="users" size={24} />
              </div>
              <span class="text-xs font-medium text-center px-2">{t.buyers}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile Flow (Vertical) -->
      <div class="lg:hidden flex flex-col items-center gap-4">
        <!-- Catalog -->
        <div class="flow-node animate-on-scroll">
          <div class="w-48 h-24 rounded-2xl bg-gradient-to-br from-sky-500 to-blue-600 flex items-center justify-center gap-3 text-white shadow-lg">
            <Icon name="car" size={28} />
            <span class="text-sm font-medium">{t.catalogLabel}</span>
          </div>
        </div>
        <Icon name="arrow-down" size={24} class="text-indigo-500 animate-bounce" />

        <!-- Feed -->
        <div class="flow-node animate-on-scroll">
          <div class="w-48 h-24 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center gap-3 text-white shadow-lg">
            <Icon name="refresh-cw" size={28} class="animate-spin-slow" />
            <span class="text-sm font-medium">{t.feedLabel}</span>
          </div>
        </div>
        <Icon name="arrow-down" size={24} class="text-pink-500 animate-bounce" style="animation-delay: 100ms" />

        <!-- Platforms -->
        <div class="flow-node animate-on-scroll">
          <div class="w-48 h-24 rounded-2xl bg-gradient-to-br from-pink-500 to-rose-600 flex flex-col items-center justify-center text-white shadow-lg">
            <div class="flex gap-2 mb-1">
              <Icon name="facebook" size={20} />
              <Icon name="instagram" size={20} />
              <Icon name="globe" size={20} />
            </div>
            <span class="text-sm font-medium">{t.platforms}</span>
          </div>
        </div>
        <Icon name="arrow-down" size={24} class="text-amber-500 animate-bounce" style="animation-delay: 200ms" />

        <!-- Buyers -->
        <div class="flow-node animate-on-scroll">
          <div class="w-48 h-24 rounded-2xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center gap-3 text-white shadow-lg">
            <Icon name="users" size={28} />
            <span class="text-sm font-medium">{t.buyers}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Step Cards -->
    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
      {t.steps.map((step, index) => (
        <div
          class="relative p-6 rounded-2xl bg-slate-50 border border-slate-100 hover:border-sky-200 hover:shadow-lg transition-all duration-300 animate-on-scroll group"
          style={`animation-delay: ${(index + 1) * 100}ms`}
        >
          <div class="absolute -top-3 -left-3 w-8 h-8 rounded-full bg-gradient-to-br from-sky-500 to-blue-600 flex items-center justify-center text-white text-sm font-bold shadow-lg">
            {index + 1}
          </div>
          <div class="w-12 h-12 rounded-xl bg-sky-100 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
            <Icon name={step.icon} size={24} class="text-sky-600" />
          </div>
          <h3 class="heading-5 mb-2">{step.title}</h3>
          <p class="text-slate-600 text-sm">{step.description}</p>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  @keyframes flow {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  .animate-flow {
    animation: flow 2s linear infinite;
  }

  @keyframes spin-slow {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .animate-spin-slow {
    animation: spin-slow 4s linear infinite;
  }

  @keyframes platform-pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.8; }
  }

  .platform-icon {
    animation: platform-pulse 2s ease-in-out infinite;
  }
</style>
