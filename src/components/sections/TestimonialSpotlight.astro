---
interface Props {
  quote: string;
  author: string;
  role: string;
  company: string;
  image?: string;
  companyLogo?: string;
}

const { quote, author, role, company, image, companyLogo } = Astro.props;

// Split quote for animation effect
const words = quote.split(' ');
---

<section class="py-24 bg-slate-900 overflow-hidden relative">
  <!-- Background effects -->
  <div class="absolute inset-0">
    <!-- Gradient orbs -->
    <div class="absolute top-0 left-1/4 w-96 h-96 bg-blue-500/20 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-violet-500/20 rounded-full blur-3xl"></div>

    <!-- Stars/dots -->
    <div class="absolute inset-0 overflow-hidden">
      {Array.from({ length: 20 }).map((_, i) => (
        <div
          class="absolute w-1 h-1 bg-white/20 rounded-full animate-twinkle"
          style={`top: ${Math.random() * 100}%; left: ${Math.random() * 100}%; animation-delay: ${Math.random() * 3}s;`}
        ></div>
      ))}
    </div>
  </div>

  <div class="container-custom relative z-10">
    <div class="max-w-4xl mx-auto text-center">
      <!-- Big quote marks -->
      <div class="flex justify-center mb-8">
        <div class="relative">
          <span class="text-[150px] font-serif text-white/5 leading-none select-none">‚ùù</span>
          <div class="absolute inset-0 flex items-center justify-center">
            <div class="w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 to-violet-500 flex items-center justify-center animate-pulse-slow">
              <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Quote with word-by-word reveal -->
      <blockquote class="quote-container text-2xl md:text-3xl lg:text-4xl text-white font-medium leading-relaxed mb-12">
        {words.map((word, index) => (
          <span
            class="quote-word inline-block opacity-0"
            style={`animation-delay: ${index * 50}ms`}
          >
            {word}&nbsp;
          </span>
        ))}
      </blockquote>

      <!-- Stars rating -->
      <div class="flex justify-center gap-1 mb-8">
        {Array.from({ length: 5 }).map((_, i) => (
          <svg
            class="w-6 h-6 text-yellow-400 star-icon"
            style={`animation-delay: ${i * 100 + 1000}ms`}
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
          </svg>
        ))}
      </div>

      <!-- Author info -->
      <div class="author-info flex flex-col sm:flex-row items-center justify-center gap-4">
        {image ? (
          <div class="relative">
            <img
              src={image}
              alt={author}
              class="w-16 h-16 rounded-full object-cover ring-4 ring-white/20"
              loading="lazy"
            />
            <div class="absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 rounded-full border-2 border-slate-900 flex items-center justify-center">
              <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
              </svg>
            </div>
          </div>
        ) : (
          <div class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-violet-500 flex items-center justify-center ring-4 ring-white/20">
            <span class="text-xl font-bold text-white">
              {author.split(' ').map(n => n[0]).join('')}
            </span>
          </div>
        )}

        <div class="text-center sm:text-left">
          <div class="text-white font-semibold text-lg">{author}</div>
          <div class="text-slate-400">{role}</div>
          <div class="flex items-center gap-2 justify-center sm:justify-start">
            {companyLogo && !image && (
              <img
                src={companyLogo}
                alt={company}
                class="h-6 w-auto object-contain"
                loading="lazy"
              />
            )}
            <span class="text-blue-400 font-medium">{company}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom wave decoration -->
  <div class="absolute bottom-0 left-0 right-0">
    <svg viewBox="0 0 1440 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full text-white">
      <path fill="currentColor" fill-opacity="0.05" d="M0,32L48,37.3C96,43,192,53,288,58.7C384,64,480,64,576,58.7C672,53,768,43,864,42.7C960,43,1056,53,1152,53.3C1248,53,1344,43,1392,37.3L1440,32L1440,100L1392,100C1344,100,1248,100,1152,100C1056,100,960,100,864,100C768,100,672,100,576,100C480,100,384,100,288,100C192,100,96,100,48,100L0,100Z"></path>
    </svg>
  </div>
</section>

<style>
  /* Quote word animation */
  .quote-word {
    animation: word-reveal 0.5s ease forwards;
  }

  @keyframes word-reveal {
    from {
      opacity: 0;
      transform: translateY(20px) rotateX(-20deg);
    }
    to {
      opacity: 1;
      transform: translateY(0) rotateX(0);
    }
  }

  /* Star animation */
  .star-icon {
    opacity: 0;
    transform: scale(0) rotate(-180deg);
    animation: star-pop 0.5s ease forwards;
  }

  @keyframes star-pop {
    to {
      opacity: 1;
      transform: scale(1) rotate(0);
    }
  }

  /* Author info animation */
  .author-info {
    animation: fade-up 0.8s ease forwards;
    animation-delay: 1.5s;
    opacity: 0;
  }

  @keyframes fade-up {
    to {
      opacity: 1;
    }
  }

  /* Twinkle animation */
  @keyframes twinkle {
    0%, 100% { opacity: 0.2; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.5); }
  }

  .animate-twinkle {
    animation: twinkle 3s ease-in-out infinite;
  }

  /* Slow pulse */
  .animate-pulse-slow {
    animation: pulse 3s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.8; }
  }
</style>

<script>
  // Trigger animations when in view
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animate-active');
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.3 }
  );

  document.querySelectorAll('.quote-container').forEach((el) => {
    observer.observe(el);
  });
</script>
