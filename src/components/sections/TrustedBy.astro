---
/**
 * TrustedBy - Client logo showcase with category filtering
 * Infinite scrolling carousel organized by industry
 */
import type { Language } from '@/i18n/config';

interface Props {
  lang: Language;
  variant?: 'default' | 'compact' | 'featured';
  showCount?: boolean;
}

const { lang, variant = 'default', showCount = true } = Astro.props;

const content = {
  en: {
    badge: 'Trusted Partners',
    title: 'Trusted by Industry Leaders',
    subtitle: 'From startups to enterprises, we help businesses grow with data-driven digital marketing.',
    count: '50+',
    countLabel: 'Happy Clients',
    cta: 'Join them →',
    categories: {
      all: 'All Clients',
      b2b: 'B2B Tech & SaaS',
      automotive: 'Automotive',
      other: 'Other Industries',
    },
  },
  fr: {
    badge: 'Partenaires de Confiance',
    title: 'Ils Nous Font Confiance',
    subtitle: 'Des startups aux grandes entreprises, nous aidons les businesses à croître avec du marketing digital data-driven.',
    count: '50+',
    countLabel: 'Clients Satisfaits',
    cta: 'Rejoignez-les →',
    categories: {
      all: 'Tous les Clients',
      b2b: 'B2B Tech & SaaS',
      automotive: 'Automobile',
      other: 'Autres Industries',
    },
  },
};

const t = content[lang] || content.en;

// Client logos organized by category (all uniform size)
const clients = {
  b2b: [
    { name: 'Genesys', logo: '/images/Client logo/genesys-vector-logo.png' },
    { name: 'Quantum Metrics', logo: '/images/Client logo/quantum.png' },
    { name: 'OpenText', logo: '/images/Client logo/opentext-logo.png' },
    { name: 'Edenred', logo: '/images/Client logo/Edenred_Logo_(depuis_2017).png' },
    { name: 'GWI', logo: '/images/Client logo/GWI.webp' },
    { name: 'Symbl.ai', logo: '/images/Client logo/Symbl.ai.png' },
    { name: 'CX Ninjas', logo: '/images/Client logo/CX Ninjas.jpeg' },
    { name: 'LuxSci', logo: '/images/Client logo/LuxSci.png' },
    { name: 'Servion', logo: '/images/Client logo/Servion.png' },
    { name: 'Veesion', logo: '/images/Client logo/veesion.png' },
    { name: 'Omilia', logo: '/images/Client logo/omilia.png' },
    { name: 'NuHerbs', logo: '/images/Client logo/nuherbs.jpg' },
    { name: 'FastSensor', logo: '/images/Client logo/fastsensor.png' },
    { name: 'Frontline', logo: '/images/Client logo/Frontline.jpeg' },
    { name: 'On Train', logo: '/images/Client logo/on train.png' },
    { name: 'Pubstack', logo: '/images/Client logo/Pubstack.webp' },
    { name: 'Solita', logo: '/images/Client logo/Solita.png' },
    { name: 'Altitude', logo: '/images/Client logo/Altitude.png' },
    { name: 'MotorK', logo: '/images/Client logo/Motork.png' },
    { name: 'Pur Lux', logo: '/images/Client logo/Pur lux.png' },
  ],
  automotive: [
    { name: 'Ford', logo: '/images/Client logo/ford.png' },
    { name: 'BYmyCAR', logo: '/images/Client logo/BYmyCAR.png' },
    { name: 'Theobald Group', logo: '/images/Client logo/Theobald.png' },
    { name: 'Vulcain Group', logo: '/images/Client logo/Vulcain.png' },
    { name: 'DMD Group', logo: '/images/Client logo/DMD.png' },
    { name: 'Warpcom', logo: '/images/Client logo/Warpcom.webp' },
    { name: 'Groupe Lancien', logo: '/images/Client logo/Iroise Auto.png' },
    { name: 'GGP Auto', logo: '/images/Client logo/GGP Auto.png' },
    { name: 'EDA 42', logo: '/images/Client logo/EDA 42.png' },
    { name: 'Auto Village', logo: '/images/Client logo/Auto village.png' },
    { name: 'Groupe Dugat', logo: '/images/Client logo/Dugat.jpg' },
    { name: 'Lotus Silverstone', logo: '/images/Client logo/lotus silverstone.png' },
    { name: 'TGPC', logo: '/images/Client logo/tgpc_logo.png' },
  ],
  other: [
    { name: 'Flighty', logo: '/images/Client logo/Flighty.png' },
    { name: 'CBCM', logo: '/images/Client logo/CBCM.png' },
    { name: 'Goola', logo: '/images/Client logo/goola.png' },
    { name: 'Unbound', logo: '/images/Client logo/Unbound.png' },
    { name: 'Fred Jeandin', logo: '/images/Client logo/fred jeandin.png' },
    { name: 'Infolawyers', logo: '/images/Client logo/infolawyers-logo350.png' },
    { name: 'Property Investor News', logo: '/images/Client logo/Property Investor News.png' },
    { name: 'Partenair', logo: '/images/Client logo/partenair-logo-1473345534.jpg' },
  ],
};

// All clients combined
const allClients = [...clients.b2b, ...clients.automotive, ...clients.other];

// Triple for seamless infinite loop
const tripleAllClients = [...allClients, ...allClients, ...allClients];
const tripleB2B = [...clients.b2b, ...clients.b2b, ...clients.b2b];
const tripleAutomotive = [...clients.automotive, ...clients.automotive, ...clients.automotive];
const tripleOther = [...clients.other, ...clients.other, ...clients.other];
---

<section class={`trusted-by overflow-hidden ${variant === 'compact' ? 'py-12' : 'section'} bg-slate-50`}>
  <div class="container-custom">
    {variant !== 'compact' && (
      <div class="text-center max-w-3xl mx-auto mb-12 animate-on-scroll">
        <span class="badge-primary mb-4">{t.badge}</span>
        <h2 class="heading-2 mb-4">{t.title}</h2>
        <p class="body-large text-slate-600">{t.subtitle}</p>
      </div>
    )}

    {variant === 'compact' && (
      <div class="flex items-center justify-between mb-8 animate-on-scroll">
        <h3 class="heading-4 text-slate-500">{t.title}</h3>
        {showCount && (
          <div class="flex items-center gap-2">
            <span class="text-3xl font-bold text-primary-500">{t.count}</span>
            <span class="text-sm text-slate-500">{t.countLabel}</span>
          </div>
        )}
      </div>
    )}

    {/* Stats row for default variant */}
    {variant === 'default' && showCount && (
      <div class="flex justify-center gap-12 mb-12 animate-on-scroll">
        <div class="text-center">
          <div class="text-5xl font-bold text-primary-500 counter" data-target="50">50+</div>
          <div class="text-sm text-slate-500 mt-1">{t.countLabel}</div>
        </div>
        <div class="text-center">
          <div class="text-5xl font-bold text-slate-900">12+</div>
          <div class="text-sm text-slate-500 mt-1">{lang === 'fr' ? 'Industries' : 'Industries'}</div>
        </div>
        <div class="text-center">
          <div class="text-5xl font-bold text-slate-900">8+</div>
          <div class="text-sm text-slate-500 mt-1">{lang === 'fr' ? 'Pays' : 'Countries'}</div>
        </div>
      </div>
    )}

    {/* Category Filter Tabs - Only for default variant */}
    {variant === 'default' && (
      <div class="flex flex-wrap justify-center gap-2 mb-8 animate-on-scroll">
        <button
          class="category-tab active px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 bg-indigo-500 text-white"
          data-category="all"
        >
          {t.categories.all}
        </button>
        <button
          class="category-tab px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:text-indigo-600"
          data-category="b2b"
        >
          {t.categories.b2b}
        </button>
        <button
          class="category-tab px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:text-indigo-600"
          data-category="automotive"
        >
          {t.categories.automotive}
        </button>
        <button
          class="category-tab px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 bg-white text-slate-600 border border-slate-200 hover:border-indigo-300 hover:text-indigo-600"
          data-category="other"
        >
          {t.categories.other}
        </button>
      </div>
    )}
  </div>

  {/* Infinite Scrolling Carousel */}
  <div class="logo-carousel relative">
    {/* Gradient masks */}
    <div class="absolute left-0 top-0 bottom-0 w-20 bg-gradient-to-r from-slate-50 to-transparent z-10 pointer-events-none"></div>
    <div class="absolute right-0 top-0 bottom-0 w-20 bg-gradient-to-l from-slate-50 to-transparent z-10 pointer-events-none"></div>

    {/* All clients track */}
    <div class="logo-track-wrapper" data-category="all">
      <div class="logo-track scroll-left flex gap-4 py-4">
        {tripleAllClients.map((client) => (
          <div class="logo-item flex-shrink-0">
            <div class="logo-box w-36 h-16 bg-white rounded-xl shadow-soft border border-slate-100 flex items-center justify-center p-2 transition-all duration-300 hover:shadow-lg hover:scale-105 hover:border-primary-500/30">
              <img
                src={client.logo}
                alt={client.name}
                class="max-w-full max-h-full object-contain transition-transform duration-300"
                loading="lazy"
              />
            </div>
          </div>
        ))}
      </div>
    </div>

    {/* B2B track */}
    <div class="logo-track-wrapper hidden" data-category="b2b">
      <div class="logo-track scroll-left flex gap-4 py-4">
        {tripleB2B.map((client) => (
          <div class="logo-item flex-shrink-0">
            <div class="logo-box w-36 h-16 bg-white rounded-xl shadow-soft border border-slate-100 flex items-center justify-center p-2 transition-all duration-300 hover:shadow-lg hover:scale-105 hover:border-primary-500/30">
              <img
                src={client.logo}
                alt={client.name}
                class="max-w-full max-h-full object-contain transition-transform duration-300"
                loading="lazy"
              />
            </div>
          </div>
        ))}
      </div>
    </div>

    {/* Automotive track */}
    <div class="logo-track-wrapper hidden" data-category="automotive">
      <div class="logo-track scroll-left flex gap-4 py-4">
        {tripleAutomotive.map((client) => (
          <div class="logo-item flex-shrink-0">
            <div class="logo-box w-36 h-16 bg-white rounded-xl shadow-soft border border-slate-100 flex items-center justify-center p-2 transition-all duration-300 hover:shadow-lg hover:scale-105 hover:border-primary-500/30">
              <img
                src={client.logo}
                alt={client.name}
                class="max-w-full max-h-full object-contain transition-transform duration-300"
                loading="lazy"
              />
            </div>
          </div>
        ))}
      </div>
    </div>

    {/* Other track */}
    <div class="logo-track-wrapper hidden" data-category="other">
      <div class="logo-track scroll-left flex gap-4 py-4">
        {tripleOther.map((client) => (
          <div class="logo-item flex-shrink-0">
            <div class="logo-box w-36 h-16 bg-white rounded-xl shadow-soft border border-slate-100 flex items-center justify-center p-2 transition-all duration-300 hover:shadow-lg hover:scale-105 hover:border-primary-500/30">
              <img
                src={client.logo}
                alt={client.name}
                class="max-w-full max-h-full object-contain transition-transform duration-300"
                loading="lazy"
              />
            </div>
          </div>
        ))}
      </div>
    </div>

    {/* Second row - scrolls right (only for default variant) */}
    {variant === 'default' && (
      <div class="logo-track-wrapper-reverse" data-category="all">
        <div class="logo-track scroll-right flex gap-4 py-4 mt-2">
          {[...tripleAllClients].reverse().map((client) => (
            <div class="logo-item flex-shrink-0">
              <div class="logo-box w-36 h-16 bg-white rounded-xl shadow-soft border border-slate-100 flex items-center justify-center p-2 transition-all duration-300 hover:shadow-lg hover:scale-105 hover:border-primary-500/30">
                <img
                  src={client.logo}
                  alt={client.name}
                  class="max-w-full max-h-full object-contain transition-transform duration-300"
                  loading="lazy"
                />
              </div>
            </div>
          ))}
        </div>
      </div>
    )}
  </div>

  {/* CTA for default variant */}
  {variant === 'default' && (
    <div class="container-custom mt-12 text-center animate-on-scroll">
      <a
        href={`/${lang}/contact`}
        class="inline-flex items-center gap-2 text-primary-500 font-medium hover:text-primary-600 transition-colors group"
      >
        {t.cta}
        <svg class="w-5 h-5 transform group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    </div>
  )}
</section>

<style>
  /* Infinite scroll animation - 30% faster */
  .logo-track {
    animation-timing-function: linear;
    animation-iteration-count: infinite;
    will-change: transform;
    cursor: grab;
  }

  .logo-track:active {
    cursor: grabbing;
  }

  .logo-track.dragging {
    animation-play-state: paused !important;
    cursor: grabbing;
  }

  .scroll-left {
    animation: scroll-left 17s linear infinite;
  }

  .scroll-right {
    animation: scroll-right 21s linear infinite;
  }

  @keyframes scroll-left {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-33.333%);
    }
  }

  @keyframes scroll-right {
    0% {
      transform: translateX(-33.333%);
    }
    100% {
      transform: translateX(0);
    }
  }

  /* Pause on hover */
  .logo-carousel:hover .logo-track:not(.dragging) {
    animation-play-state: paused;
  }

  /* Logo item hover effect */
  .logo-item {
    perspective: 1000px;
    user-select: none;
  }

  .logo-item:hover {
    z-index: 10;
  }

  /* Category tab styles */
  .category-tab.active {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: white;
    border: none;
  }

  /* Mobile - smaller logos, more visible, faster */
  @media (max-width: 768px) {
    .scroll-left {
      animation-duration: 12s;
    }
    .scroll-right {
      animation-duration: 15s;
    }
    .logo-box {
      width: 90px !important;
      height: 40px !important;
      padding: 0.25rem !important;
    }
    .logo-track {
      gap: 0.75rem !important;
    }
  }
</style>

<script>
  // Category filter and drag functionality
  document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.category-tab');
    const trackWrappers = document.querySelectorAll('.logo-track-wrapper');
    const reverseWrapper = document.querySelector('.logo-track-wrapper-reverse');

    // Category filter
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const category = tab.getAttribute('data-category');

        // Update active tab
        tabs.forEach(t => {
          t.classList.remove('active');
          t.classList.add('bg-white', 'text-slate-600', 'border', 'border-slate-200');
        });
        tab.classList.add('active');
        tab.classList.remove('bg-white', 'text-slate-600', 'border', 'border-slate-200');

        // Show/hide track wrappers
        trackWrappers.forEach(wrapper => {
          const wrapperCategory = wrapper.getAttribute('data-category');
          if (wrapperCategory === category) {
            wrapper.classList.remove('hidden');
          } else {
            wrapper.classList.add('hidden');
          }
        });

        // Show/hide reverse track (only for "all" category)
        if (reverseWrapper) {
          if (category === 'all') {
            reverseWrapper.classList.remove('hidden');
          } else {
            reverseWrapper.classList.add('hidden');
          }
        }
      });
    });

    // Drag/grab functionality for carousel
    const carousel = document.querySelector('.logo-carousel');
    if (carousel) {
      const tracks = carousel.querySelectorAll('.logo-track') as NodeListOf<HTMLElement>;

      tracks.forEach(track => {
        let isDragging = false;
        let startX = 0;
        let scrollLeft = 0;
        let currentTranslate = 0;

        // Get current translateX from computed style or animation
        const getTranslateX = () => {
          const style = window.getComputedStyle(track);
          const matrix = new DOMMatrixReadOnly(style.transform);
          return matrix.m41;
        };

        const startDragging = (e: MouseEvent | TouchEvent) => {
          isDragging = true;
          track.classList.add('dragging');
          startX = 'touches' in e ? e.touches[0].pageX : e.pageX;
          currentTranslate = getTranslateX();
          track.style.transform = `translateX(${currentTranslate}px)`;
        };

        const drag = (e: MouseEvent | TouchEvent) => {
          if (!isDragging) return;
          e.preventDefault();
          const x = 'touches' in e ? e.touches[0].pageX : e.pageX;
          const walk = (x - startX) * 1.5; // Multiplier for faster drag
          track.style.transform = `translateX(${currentTranslate + walk}px)`;
        };

        const stopDragging = () => {
          if (!isDragging) return;
          isDragging = false;
          track.classList.remove('dragging');
          // Resume animation from current position - let CSS animation take over
          track.style.transform = '';
        };

        // Mouse events
        track.addEventListener('mousedown', startDragging);
        track.addEventListener('mousemove', drag);
        track.addEventListener('mouseup', stopDragging);
        track.addEventListener('mouseleave', stopDragging);

        // Touch events
        track.addEventListener('touchstart', startDragging, { passive: true });
        track.addEventListener('touchmove', drag, { passive: false });
        track.addEventListener('touchend', stopDragging);
      });

      // Pause animation when not in viewport for performance
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            tracks.forEach((track) => {
              if (!track.classList.contains('dragging')) {
                track.style.animationPlayState = entry.isIntersecting ? 'running' : 'paused';
              }
            });
          });
        },
        { threshold: 0.1 }
      );
      observer.observe(carousel);
    }
  });
</script>
