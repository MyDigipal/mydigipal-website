---
/**
 * ServiceSchema Component
 * Generates JSON-LD structured data for service pages
 *
 * Usage:
 * <ServiceSchema
 *   name="SEO Services"
 *   description="Professional SEO services..."
 *   url="https://mydigipal.com/en/services/seo"
 *   image="/images/services/seo.jpg"
 *   lang="en"
 *   serviceType="SearchEngineOptimization"
 * />
 *
 * Note: aggregateRating is only included when ratingValue > 0 and reviewCount > 0.
 * Only pass these values if based on verified, real customer reviews.
 */

interface Props {
  name: string;
  description: string;
  url: string;
  image?: string;
  lang?: 'en' | 'fr';
  serviceType?: string;
  ratingValue?: number;
  reviewCount?: number;
}

const {
  name,
  description,
  url,
  image,
  lang = 'en',
  serviceType = 'ProfessionalService',
  ratingValue = 0,
  reviewCount = 0
} = Astro.props;

const hasVerifiedRating = ratingValue > 0 && reviewCount > 0;

const serviceSchema = {
  "@context": "https://schema.org",
  "@type": "Service",
  "serviceType": serviceType,
  "name": name,
  "description": description,
  "url": url,
  "provider": {
    "@id": "https://mydigipal.com/#organization"
  },
  "areaServed": [
    {
      "@type": "Country",
      "name": "France"
    },
    {
      "@type": "Country",
      "name": "United Kingdom"
    },
    {
      "@type": "Country",
      "name": "Germany"
    }
  ],
  "availableChannel": {
    "@type": "ServiceChannel",
    "serviceLocation": {
      "@type": "Place",
      "name": "MyDigipal Paris Office",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "128 Rue de la Bo√©tie",
        "addressLocality": "Paris",
        "postalCode": "75008",
        "addressCountry": "FR"
      }
    },
    "availableLanguage": ["English", "French"]
  },
  ...(image && {
    "image": image.startsWith('http') ? image : `https://mydigipal.com${image}`
  }),
  ...(hasVerifiedRating && {
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": ratingValue,
      "bestRating": 5,
      "worstRating": 1,
      "reviewCount": reviewCount
    }
  })
};
---

<script type="application/ld+json" set:html={JSON.stringify(serviceSchema)} />
